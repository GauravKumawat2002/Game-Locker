# ============================================
# GameLocker Build Commands - SELF-CONTAINED
# ============================================
# This creates a build that INCLUDES .NET Runtime
# Users DON'T need to install .NET separately!
# ============================================

# 1. Navigate to project directory
cd "h:\Work\10xProductivity\game_locker\code"

# 2. Clean previous builds
dotnet clean GameLocker.sln -c Release

# 3. Build Service (SELF-CONTAINED with .NET Runtime included)
dotnet publish src/GameLocker.Service/GameLocker.Service.csproj `
  -c Release `
  -r win-x64 `
  --self-contained true `
  -p:PublishSingleFile=false `
  -p:IncludeNativeLibrariesForSelfExtract=true `
  -o "installer-package/publish/service"

# 4. Build ConfigUI (SELF-CONTAINED with .NET Runtime included)
dotnet publish src/GameLocker.ConfigUI/GameLocker.ConfigUI.csproj `
  -c Release `
  -r win-x64 `
  --self-contained true `
  -p:PublishSingleFile=false `
  -p:IncludeNativeLibrariesForSelfExtract=true `
  -o "installer-package/publish/configui"

# 5. Copy installer scripts
Copy-Item "installer/PowerShell/GameLocker-Setup.ps1" -Destination "installer-package/GameLocker-Setup.ps1" -Force
Copy-Item "installer/PowerShell/Package-Installer.ps1" -Destination "installer-package/Package-Installer.ps1" -Force

# 6. Create ZIP installer
Remove-Item "h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.zip" -Force -ErrorAction SilentlyContinue
Compress-Archive -Path "installer-package\*" -DestinationPath "h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.zip" -Force

# 7. Verify
Get-Item "h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.zip" | Select-Object Name, @{N='SizeMB';E={[math]::Round($_.Length/1MB,2)}}, LastWriteTime


# ============================================
# PROPER INSTALLER (Recommended!)
# ============================================
# This creates a real .EXE installer with UI

# Step 1: Install Inno Setup (if not installed)
# Download from: https://jrsoftware.org/isdl.php
# OR using Chocolatey:
# choco install innosetup -y

# Step 2: Build the applications (same as above steps 1-4)

# Step 3: Compile the Inno Setup installer
& "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" "installer\InnoSetup\GameLocker-Setup.iss"

# The installer will be created at:
# h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.exe


# ============================================
# ONE-LINER for ZIP (Self-Contained)
# ============================================
cd "h:\Work\10xProductivity\game_locker\code"; dotnet clean GameLocker.sln -c Release; dotnet publish src/GameLocker.Service/GameLocker.Service.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=false -o "installer-package/publish/service"; dotnet publish src/GameLocker.ConfigUI/GameLocker.ConfigUI.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=false -o "installer-package/publish/configui"; Copy-Item "installer/PowerShell/GameLocker-Setup.ps1" -Destination "installer-package/GameLocker-Setup.ps1" -Force; Copy-Item "installer/PowerShell/Package-Installer.ps1" -Destination "installer-package/Package-Installer.ps1" -Force; Remove-Item "h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.zip" -Force -ErrorAction SilentlyContinue; Compress-Archive -Path "installer-package\*" -DestinationPath "h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.zip" -Force; Get-Item "h:\Work\10xProductivity\game_locker\GameLocker-Installer-v1.1.0.zip" | Select-Object Name, @{N='SizeMB';E={[math]::Round($_.Length/1MB,2)}}, LastWriteTime
